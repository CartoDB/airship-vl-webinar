!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AsBridge=t():e.AsBridge=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){(function(r){var n;t=e.exports=Z,n="object"==typeof r&&r.env&&r.env.NODE_DEBUG&&/\bsemver\b/i.test(r.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var i=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,a=t.re=[],s=t.src=[],u=0,l=u++;s[l]="0|[1-9]\\d*";var c=u++;s[c]="[0-9]+";var p=u++;s[p]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var h=u++;s[h]="("+s[l]+")\\.("+s[l]+")\\.("+s[l]+")";var f=u++;s[f]="("+s[c]+")\\.("+s[c]+")\\.("+s[c]+")";var m=u++;s[m]="(?:"+s[l]+"|"+s[p]+")";var v=u++;s[v]="(?:"+s[c]+"|"+s[p]+")";var d=u++;s[d]="(?:-("+s[m]+"(?:\\."+s[m]+")*))";var _=u++;s[_]="(?:-?("+s[v]+"(?:\\."+s[v]+")*))";var y=u++;s[y]="[0-9A-Za-z-]+";var g=u++;s[g]="(?:\\+("+s[y]+"(?:\\."+s[y]+")*))";var b=u++,w="v?"+s[h]+s[d]+"?"+s[g]+"?";s[b]="^"+w+"$";var j="[v=\\s]*"+s[f]+s[_]+"?"+s[g]+"?",L=u++;s[L]="^"+j+"$";var x=u++;s[x]="((?:<|>)?=?)";var O=u++;s[O]=s[c]+"|x|X|\\*";var E=u++;s[E]=s[l]+"|x|X|\\*";var P=u++;s[P]="[v=\\s]*("+s[E]+")(?:\\.("+s[E]+")(?:\\.("+s[E]+")(?:"+s[d]+")?"+s[g]+"?)?)?";var T=u++;s[T]="[v=\\s]*("+s[O]+")(?:\\.("+s[O]+")(?:\\.("+s[O]+")(?:"+s[_]+")?"+s[g]+"?)?)?";var k=u++;s[k]="^"+s[x]+"\\s*"+s[P]+"$";var S=u++;s[S]="^"+s[x]+"\\s*"+s[T]+"$";var C=u++;s[C]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var z=u++;s[z]="(?:~>?)";var D=u++;s[D]="(\\s*)"+s[z]+"\\s+",a[D]=new RegExp(s[D],"g");var H=u++;s[H]="^"+s[z]+s[P]+"$";var R=u++;s[R]="^"+s[z]+s[T]+"$";var $=u++;s[$]="(?:\\^)";var V=u++;s[V]="(\\s*)"+s[$]+"\\s+",a[V]=new RegExp(s[V],"g");var A=u++;s[A]="^"+s[$]+s[P]+"$";var F=u++;s[F]="^"+s[$]+s[T]+"$";var I=u++;s[I]="^"+s[x]+"\\s*("+j+")$|^$";var M=u++;s[M]="^"+s[x]+"\\s*("+w+")$|^$";var N=u++;s[N]="(\\s*)"+s[x]+"\\s*("+j+"|"+s[P]+")",a[N]=new RegExp(s[N],"g");var B=u++;s[B]="^\\s*("+s[P]+")\\s+-\\s+("+s[P]+")\\s*$";var U=u++;s[U]="^\\s*("+s[T]+")\\s+-\\s+("+s[T]+")\\s*$";var q=u++;s[q]="(<|>)?=?\\s*\\*";for(var X=0;X<35;X++)n(X,s[X]),a[X]||(a[X]=new RegExp(s[X]));function G(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof Z)return e;if("string"!=typeof e)return null;if(e.length>i)return null;if(!(t.loose?a[L]:a[b]).test(e))return null;try{return new Z(e,t)}catch(e){return null}}function Z(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof Z){if(e.loose===t.loose)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>i)throw new TypeError("version is longer than "+i+" characters");if(!(this instanceof Z))return new Z(e,t);n("SemVer",e,t),this.options=t,this.loose=!!t.loose;var r=e.trim().match(t.loose?a[L]:a[b]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<o)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}t.parse=G,t.valid=function(e,t){var r=G(e,t);return r?r.version:null},t.clean=function(e,t){var r=G(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null},t.SemVer=Z,Z.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Z.prototype.toString=function(){return this.version},Z.prototype.compare=function(e){return n("SemVer.compare",this.version,this.options,e),e instanceof Z||(e=new Z(e,this.options)),this.compareMain(e)||this.comparePre(e)},Z.prototype.compareMain=function(e){return e instanceof Z||(e=new Z(e,this.options)),J(this.major,e.major)||J(this.minor,e.minor)||J(this.patch,e.patch)},Z.prototype.comparePre=function(e){if(e instanceof Z||(e=new Z(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return J(r,i)}while(++t)},Z.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,r,n){"string"==typeof r&&(n=r,r=void 0);try{return new Z(e,r).inc(t,n).version}catch(e){return null}},t.diff=function(e,t){if(ee(e,t))return null;var r=G(e),n=G(t);if(r.prerelease.length||n.prerelease.length){for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return"pre"+i;return"prerelease"}for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return i},t.compareIdentifiers=J;var W=/^[0-9]+$/;function J(e,t){var r=W.test(e),n=W.test(t);return r&&n&&(e=+e,t=+t),r&&!n?-1:n&&!r?1:e<t?-1:e>t?1:0}function K(e,t,r){return new Z(e,r).compare(new Z(t,r))}function Q(e,t,r){return K(e,t,r)>0}function Y(e,t,r){return K(e,t,r)<0}function ee(e,t,r){return 0===K(e,t,r)}function te(e,t,r){return 0!==K(e,t,r)}function re(e,t,r){return K(e,t,r)>=0}function ne(e,t,r){return K(e,t,r)<=0}function ie(e,t,r,n){var i;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e===r;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),i=e!==r;break;case"":case"=":case"==":i=ee(e,r,n);break;case"!=":i=te(e,r,n);break;case">":i=Q(e,r,n);break;case">=":i=re(e,r,n);break;case"<":i=Y(e,r,n);break;case"<=":i=ne(e,r,n);break;default:throw new TypeError("Invalid operator: "+t)}return i}function oe(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof oe){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof oe))return new oe(e,t);n("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ae?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}t.rcompareIdentifiers=function(e,t){return J(t,e)},t.major=function(e,t){return new Z(e,t).major},t.minor=function(e,t){return new Z(e,t).minor},t.patch=function(e,t){return new Z(e,t).patch},t.compare=K,t.compareLoose=function(e,t){return K(e,t,!0)},t.rcompare=function(e,t,r){return K(t,e,r)},t.sort=function(e,r){return e.sort(function(e,n){return t.compare(e,n,r)})},t.rsort=function(e,r){return e.sort(function(e,n){return t.rcompare(e,n,r)})},t.gt=Q,t.lt=Y,t.eq=ee,t.neq=te,t.gte=re,t.lte=ne,t.cmp=ie,t.Comparator=oe;var ae={};function se(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof se)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new se(e.raw,t);if(e instanceof oe)return new se(e.value,t);if(!(this instanceof se))return new se(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function ue(e){return!e||"x"===e.toLowerCase()||"*"===e}function le(e,t,r,n,i,o,a,s,u,l,c,p,h){return((t=ue(r)?"":ue(n)?">="+r+".0.0":ue(i)?">="+r+"."+n+".0":">="+t)+" "+(s=ue(u)?"":ue(l)?"<"+(+u+1)+".0.0":ue(c)?"<"+u+"."+(+l+1)+".0":p?"<="+u+"."+l+"."+c+"-"+p:"<="+s)).trim()}function ce(e,t,r){for(var i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(r||(r={}),t.prerelease.length&&!r.includePrerelease){for(i=0;i<e.length;i++)if(n(e[i].semver),e[i].semver!==ae&&e[i].semver.prerelease.length>0){var o=e[i].semver;if(o.major===t.major&&o.minor===t.minor&&o.patch===t.patch)return!0}return!1}return!0}function pe(e,t,r){try{t=new se(t,r)}catch(e){return!1}return t.test(e)}function he(e,t,r,n){var i,o,a,s,u;switch(e=new Z(e,n),t=new se(t,n),r){case">":i=Q,o=ne,a=Y,s=">",u=">=";break;case"<":i=Y,o=re,a=Q,s="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(pe(e,t,n))return!1;for(var l=0;l<t.set.length;++l){var c=t.set[l],p=null,h=null;if(c.forEach(function(e){e.semver===ae&&(e=new oe(">=0.0.0")),p=p||e,h=h||e,i(e.semver,p.semver,n)?p=e:a(e.semver,h.semver,n)&&(h=e)}),p.operator===s||p.operator===u)return!1;if((!h.operator||h.operator===s)&&o(e,h.semver))return!1;if(h.operator===u&&a(e,h.semver))return!1}return!0}oe.prototype.parse=function(e){var t=this.options.loose?a[I]:a[M],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],"="===this.operator&&(this.operator=""),r[2]?this.semver=new Z(r[2],this.options.loose):this.semver=ae},oe.prototype.toString=function(){return this.value},oe.prototype.test=function(e){return n("Comparator.test",e,this.options.loose),this.semver===ae||("string"==typeof e&&(e=new Z(e,this.options)),ie(e,this.operator,this.semver,this.options))},oe.prototype.intersects=function(e,t){if(!(e instanceof oe))throw new TypeError("a Comparator is required");var r;if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return r=new se(e.value,t),pe(this.value,r,t);if(""===e.operator)return r=new se(this.value,t),pe(e.semver,r,t);var n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),o=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=ie(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),u=ie(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||i||o&&a||s||u},t.Range=se,se.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},se.prototype.toString=function(){return this.range},se.prototype.parseRange=function(e){var t=this.options.loose;e=e.trim();var r=t?a[U]:a[B];e=e.replace(r,le),n("hyphen replace",e),e=e.replace(a[N],"$1$2$3"),n("comparator trim",e,a[N]),e=(e=(e=e.replace(a[D],"$1~")).replace(a[V],"$1^")).split(/\s+/).join(" ");var i=t?a[I]:a[M],o=e.split(" ").map(function(e){return function(e,t){return n("comp",e,t),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){n("caret",e,t),t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1});var r=t.loose?a[F]:a[A];return e.replace(r,function(t,r,i,o,a){var s;return n("caret",e,t,r,i,o,a),ue(r)?s="":ue(i)?s=">="+r+".0.0 <"+(+r+1)+".0.0":ue(o)?s="0"===r?">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":">="+r+"."+i+".0 <"+(+r+1)+".0.0":a?(n("replaceCaret pr",a),"-"!==a.charAt(0)&&(a="-"+a),s="0"===r?"0"===i?">="+r+"."+i+"."+o+a+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+a+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+a+" <"+(+r+1)+".0.0"):(n("no pr"),s="0"===r?"0"===i?">="+r+"."+i+"."+o+" <"+r+"."+i+"."+(+o+1):">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+o+" <"+(+r+1)+".0.0"),n("caret return",s),s})}(e,t)}).join(" ")}(e,t),n("caret",e),e=function(e,t){return e.trim().split(/\s+/).map(function(e){return function(e,t){t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1});var r=t.loose?a[R]:a[H];return e.replace(r,function(t,r,i,o,a){var s;return n("tilde",e,t,r,i,o,a),ue(r)?s="":ue(i)?s=">="+r+".0.0 <"+(+r+1)+".0.0":ue(o)?s=">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":a?(n("replaceTilde pr",a),"-"!==a.charAt(0)&&(a="-"+a),s=">="+r+"."+i+"."+o+a+" <"+r+"."+(+i+1)+".0"):s=">="+r+"."+i+"."+o+" <"+r+"."+(+i+1)+".0",n("tilde return",s),s})}(e,t)}).join(" ")}(e,t),n("tildes",e),e=function(e,t){return n("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return function(e,t){e=e.trim(),t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1});var r=t.loose?a[S]:a[k];return e.replace(r,function(t,r,i,o,a,s){n("xRange",e,t,r,i,o,a,s);var u=ue(i),l=u||ue(o),c=l||ue(a),p=c;return"="===r&&p&&(r=""),u?t=">"===r||"<"===r?"<0.0.0":"*":r&&p?(l&&(o=0),c&&(a=0),">"===r?(r=">=",l?(i=+i+1,o=0,a=0):c&&(o=+o+1,a=0)):"<="===r&&(r="<",l?i=+i+1:o=+o+1),t=r+i+"."+o+"."+a):l?t=">="+i+".0.0 <"+(+i+1)+".0.0":c&&(t=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0"),n("xRange return",t),t})}(e,t)}).join(" ")}(e,t),n("xrange",e),e=function(e,t){return n("replaceStars",e,t),e.trim().replace(a[q],"")}(e,t),n("stars",e),e}(e,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(o=o.filter(function(e){return!!e.match(i)})),o=o.map(function(e){return new oe(e,this.options)},this)},se.prototype.intersects=function(e,t){if(!(e instanceof se))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(r){return e.set.some(function(e){return e.every(function(e){return r.intersects(e,t)})})})})},t.toComparators=function(e,t){return new se(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},se.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new Z(e,this.options));for(var t=0;t<this.set.length;t++)if(ce(this.set[t],e,this.options))return!0;return!1},t.satisfies=pe,t.maxSatisfying=function(e,t,r){var n=null,i=null;try{var o=new se(t,r)}catch(e){return null}return e.forEach(function(e){o.test(e)&&(n&&-1!==i.compare(e)||(i=new Z(n=e,r)))}),n},t.minSatisfying=function(e,t,r){var n=null,i=null;try{var o=new se(t,r)}catch(e){return null}return e.forEach(function(e){o.test(e)&&(n&&1!==i.compare(e)||(i=new Z(n=e,r)))}),n},t.validRange=function(e,t){try{return new se(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,r){return he(e,t,"<",r)},t.gtr=function(e,t,r){return he(e,t,">",r)},t.outside=he,t.prerelease=function(e,t){var r=G(e,t);return r&&r.prerelease.length?r.prerelease:null},t.intersects=function(e,t,r){return e=new se(e,r),t=new se(t,r),e.intersects(t)},t.coerce=function(e){if(e instanceof Z)return e;if("string"!=typeof e)return null;var t=e.match(a[C]);return null==t?null:G((t[1]||"0")+"."+(t[2]||"0")+"."+(t[3]||"0"))}}).call(this,r(1))},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,l=[],c=!1,p=-1;function h(){c&&u&&(c=!1,u.length?l=u.concat(l):p=-1,l.length&&f())}function f(){if(!c){var e=s(h);c=!0;for(var t=l.length;t;){for(u=l,l=[];++p<t;)u&&u[p].run();p=-1,t=l.length}u=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new m(e,t)),1!==l.length||c||s(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n);var o=function(e){return e=e||Object.create(null),{on:function(t,r){(e[t]||(e[t]=[])).push(r)},off:function(t,r){e[t]&&e[t].splice(e[t].indexOf(r)>>>0,1)},emit:function(t,r){(e[t]||[]).slice().map(function(e){e(r)}),(e["*"]||[]).slice().map(function(e){e(t,r)})}}},a=function(){function e(t,r,n,i,a){void 0===a&&(a=!0),this._emitter=new o,this._name="asbind_"+t+"_"+r+"_"+e._counter,this._column=r,this._layer=n,this._source=i,this._readOnly=a,e._counter++,this._loadLegendData=this._loadLegendData.bind(this)}return Object.defineProperty(e.prototype,"globalExpression",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"column",{get:function(){return this._column},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readOnly",{get:function(){return this._readOnly},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),e.prototype.on=function(e,t){this._emitter.on(e,t)},e.prototype.setLegendData=function(e){this._legendData=e.data},e.prototype.enableColorMapping=function(){this._mapColors=!0,this._layer.viz?this._loadLegendData():this._layer.on("loaded",this._loadLegendData)},e.prototype._filterChanged=function(){this._emitter.emit("filterChanged",this._name)},e.prototype._loadLegendData=function(){var e=this._layer.viz.color;e.getLegendData&&this.setLegendData(e.getLegendData(this._getLegendConfig()))},e.prototype._getLegendConfig=function(){},e._counter=0,e}();function s(e,t){return l(e.value,t.value,c)}function u(e,t){return l(e.value,t.value,p)}function l(e,t,r){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(r(e[n],t[n]))return!1;return!0}function c(e,t){return e.x[0]!==t.x[0]||e.x[1]!==t.x[1]||e.y!==t.y}function p(e,t){return e.x!==t.x||e.y!==t.y}function h(e){return"string"==typeof e?e:function(e){return"#"+f(e.r)+f(e.g)+f(e.b)+f(255*e.a)}(e)}function f(e){return isNaN(e)||void 0===e?"":e.toString(16).padStart(2,"0").toUpperCase()}function m(e){return e.value.map(function(e){return{end:e.x[1],start:e.x[0],value:e.y}})}function v(e,t){return e.value.map(function(e){return{category:e.x,color:d(e.x,t),end:void 0,start:void 0,value:e.y}})}function d(e,t){if(t){var r=t.find(function(t){return t.key===e});return r?h(r.value):void 0}}var _,y=function(e,t){return e.value.map(function(e){return{color:d(e.x,t),name:e.x,value:e.y}})},g=(_=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),b=function(e){function t(t,r,n,i,o,a){void 0===a&&(a=!0);var s=e.call(this,"category",i,r,o,a)||this;return s._selection=[],s._lastHistogram=null,s._widget=n,s._carto=t,n.disableInteractivity=a,n.showClearButton=!a,s.selectionChanged=s.selectionChanged.bind(s),a||s._widget.addEventListener("categoriesSelected",s.selectionChanged),s}return g(t,e),t.prototype.setDataLayer=function(e){var t=this;this._dataLayer=e,this._dataLayer.on("updated",function(){var e=t._dataLayer.viz.variables[t.name];e&&(null!==t._lastHistogram&&u(t._lastHistogram,e)||(t._lastHistogram={value:e.value},t._widget.categories=y(e,t._legendData)))})},Object.defineProperty(t.prototype,"filter",{get:function(){return 0===this._selection.length?null:"$"+this._column+" in ["+this._selection.map(function(e){return"'"+e+"'"}).join(",")+"]"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression",{get:function(){var e=this._carto.expressions;return e.viewportHistogram(e.prop(this._column))},enumerable:!0,configurable:!0}),t.prototype.selectionChanged=function(e){this._selection=e.detail,this._filterChanged()},t}(a),w=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),j=function(e){function t(t,r,n,i,o,a,s){void 0===s&&(s=!0);var u=e.call(this,"histogram_"+t,o,n,a,s)||this;return u._selection=null,u._widget=i,u._carto=r,i.disableInteractivity=s,i.showClear=!s,u.selectionChanged=u.selectionChanged.bind(u),s||u._widget.addEventListener("selectionChanged",u.selectionChanged),u}return w(t,e),t.prototype.removeHistogramLayer=function(){this._layer.remove()},t.prototype.setDataLayer=function(e){this._dataLayer=e,this.bindDataLayer()},t.prototype._getLegendConfig=function(){return{samples:this._buckets}},t}(a),L=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),x=function(e){function t(t,r,n,i,o,a){void 0===a&&(a=!0);var s=e.call(this,"categorical",t,r,n,i,o,a)||this;return s._lastHistogram=null,s}return L(t,e),Object.defineProperty(t.prototype,"filter",{get:function(){return null===this._selection?null:"$"+this._column+" in ["+this._selection.map(function(e){return"'"+e+"'"}).join(",")+"]"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression",{get:function(){var e=this._carto.expressions;return e.viewportHistogram(e.prop(this._column))},enumerable:!0,configurable:!0}),t.prototype.bindDataLayer=function(){var e=this;this._dataLayer.on("updated",function(){var t=e._dataLayer.viz.variables[e.name];t&&(null!==e._lastHistogram&&u(e._lastHistogram,t)||(e._lastHistogram={value:t.value},e._widget.data=v(t,e._legendData)))})},t.prototype.selectionChanged=function(e){if(null===e.detail)this._selection=null;else{var t=e.detail.selection;this._selection=t.map(function(e){return e})}this._filterChanged()},t}(j),O=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),E=function(e){function t(t,r,n,i,o,a,s,u,l){void 0===u&&(u=!0),void 0===l&&(l=!1);var c=e.call(this,"numerical",t,r,n,i,a,u)||this;return c._lastHistogram=null,c._buckets=void 0!==s?s.length:o,c._bucketRanges=s,c._totals=l,c}return O(t,e),Object.defineProperty(t.prototype,"filter",{get:function(){return null===this._selection||this._isTimeSeries?null:"($"+this._column+" >= "+this._selection[0]+" and $"+this._column+" < "+this._selection[1]+")"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expression",{get:function(){if(this._totals&&!this._globalHistogram)return null;var e=this._carto.expressions;return e.viewportHistogram(e.prop(this._column),this._bucketArg())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalExpression",{get:function(){if(!this._totals)return null;var e=this._carto.expressions;return e.globalHistogram(e.prop(this._column),this._bucketArg())},enumerable:!0,configurable:!0}),t.prototype.setTimeSeries=function(e){this._isTimeSeries=e},t.prototype.enableColorMapping=function(){throw new Error("Unsupported for numerical histograms")},t.prototype.setLegendData=function(){throw new Error("Unsupported for numerical histograms")},t.prototype.bindDataLayer=function(){var e=this;this._dataLayer.on("updated",function(){e._totals&&!e._globalHistogram&&(e._globalHistogram=e._dataLayer.viz.variables[e.name+"_global"],e._globalHistogram&&(e._bucketRanges=e._globalHistogram.value.map(function(e){return[e.x[0],e.x[1]]}),e._emitter.emit("expressionReady",{name:e.name,expression:e.expression})),e._widget.backgroundData=m(e._globalHistogram));var t=e._dataLayer.viz.variables[e.name];t&&(null===t.value||null!==e._lastHistogram&&s(e._lastHistogram,t)||(e._emitter.emit("rangeChanged",[t.value[0].x[0],t.value[t.value.length-1].x[1]]),e._lastHistogram={value:t.value},e._widget.data=m(t)))})},t.prototype.selectionChanged=function(e){if(null===e.detail)this._selection=null;else{var t=this._isTimeSeries?e.detail:e.detail.selection;this._selection=[Number(t[0]),Number(t[1])]}this._emitter.emit("rangeChanged",this._selection),this._filterChanged()},t.prototype._bucketArg=function(){return void 0!==this._bucketRanges?this._bucketRanges:this._buckets},t}(j),P=function(){function e(e,t,r){var n=this;this._timeSeries=t,this._layer=e,e.viz?(this._onLayerLoaded(),r()):e.on("loaded",function(){n._onLayerLoaded(),r()})}return e.prototype.removeHistogramLayer=function(){this._dataLayer.remove()},e.prototype.setRange=function(e){this._animation&&this._animation.input&&this._animation.input.min&&this._animation.input.max&&(null===e?(this._animation.input.min.blendTo(this._min,0),this._animation.input.max.blendTo(this._max,0)):(this._animation.input.min.blendTo(e[0],0),this._animation.input.max.blendTo(e[1],0)))},e.prototype._onLayerLoaded=function(){var e=this;if(this._viz=this._layer.viz,!this._viz.variables.animation)throw new Error("Variable @animation missing!");this._animation=this._viz.variables.animation,this._max=this._viz.variables.animation.input.max,this._min=this._viz.variables.animation.input.min,this._layer.on("updated",function(){e._timeSeries.progress=100*e._animation.getProgressPct(),e._timeSeries.playing=e._animation.isPlaying()}),this._timeSeries.animated=!0,this._timeSeries.addEventListener("seek",function(t){e._animation.setProgressPct(t.detail/100),e._timeSeries.progress=t.detail}),this._timeSeries.addEventListener("play",function(){e._animation.play()}),this._timeSeries.addEventListener("pause",function(){e._animation.pause()})},e}(),T="^1.1.0",k=function(){function e(e,t,r,n){if(this._vizFilters=[],this._carto=e,this._map=t,this._layer=r,this._source=n,this._id=r.id,this._rebuildFilters=this._rebuildFilters.bind(this),this._updateDataLayerVariables=this._updateDataLayerVariables.bind(this),!i.a.satisfies(e.version,T))throw new Error("Provided VL version "+e.version+" not supported. Must satisfy "+T)}return e.prototype.numericalHistogram=function(e){var t=e.column,r=e.buckets,n=e.bucketRanges,i=e.readOnly,o=e.widget,a=new E(this._carto,this._layer,o,t,r,this._source,n,i);return this._addFilter(a),a},e.prototype.categoricalHistogram=function(e){var t=e.column,r=e.readOnly,n=e.widget,i=new x(this._carto,this._layer,n,t,this._source,r);return this._addFilter(i),i},e.prototype.histogram=function(e){var t=e.column,r=e.buckets,n=e.bucketRanges,i=e.readOnly,o=e.widget;if(void 0===r&&void 0===n){var a=o;return this.categoricalHistogram({column:t,readOnly:i,widget:a})}return this.numericalHistogram({column:t,readOnly:i,buckets:r,bucketRanges:n,widget:o})},e.prototype.category=function(e){var t=e.column,r=e.readOnly,n=e.widget,i=new b(this._carto,this._layer,n,t,this._source,r);return this._addFilter(i),i},e.prototype.timeSeries=function(e){var t=this,r=e.column,n=e.buckets,i=e.readOnly,o=e.widget;if(this._animation)throw new Error("There can only be one Time Series animation");this._animation=new P(this._layer,o,function(){t._rebuildFilters()});var a=this.numericalHistogram({buckets:n,column:r,readOnly:i,widget:o});a.setTimeSeries(!0),a.on("rangeChanged",function(e){t._animation.setRange(e)})},e.prototype.build=function(){var e=this;if(0!==this._vizFilters.length){var t=function(){e._appendVariables(),e._buildDataLayer()};this._layer.viz?t():this._layer.on("loaded",t)}},e.prototype._addFilter=function(e){e.on("filterChanged",this._rebuildFilters),e.on("expressionReady",this._updateDataLayerVariables),this._vizFilters.push(e)},e.prototype._appendVariables=function(){var e=this,t=this._carto.expressions;this._vizFilters.forEach(function(r){return e._layer.viz.variables[r.name+"_col"]=t.prop(r.column)})},e.prototype._buildDataLayer=function(){var e=this,t=this._getVariables(),r=this._carto.expressions,n=new this._carto.Viz({color:r.rgba(0,0,0,0),strokeWidth:0,variables:t});this._readOnlyLayer=new this._carto.Layer("asbind_ro_"+this._id,this._source,n),this._readOnlyLayer.addTo(this._map),this._vizFilters.forEach(function(t){return t.setDataLayer(e._readOnlyLayer)})},e.prototype._getVariables=function(){for(var e=void 0!==this._readOnlyLayer?this._readOnlyLayer.viz.variables:{},t=0,r=this._vizFilters;t<r.length;t++){var n=r[t],i=n.name;n.globalExpression&&(e[i+"_global"]=n.globalExpression),n.expression&&(e[i]=n.expression)}return e},e.prototype._updateDataLayerVariables=function(e){this._readOnlyLayer.viz&&(this._readOnlyLayer.viz.variables[e.name]=e.expression)},e.prototype._rebuildFilters=function(){var e=this._combineFilters(this._vizFilters.filter(function(e){return null!==e.filter}).map(function(e){return e.filter}));this._readOnlyLayer&&this._readOnlyLayer.viz.filter.blendTo(e,0),this._animation&&(e="@animation and "+e),this._layer.viz.filter.blendTo(e,0)},e.prototype._combineFilters=function(e){return 0===e.length?"1":e.join(" and ")},e}();r.d(t,"VLBridge",function(){return k})}])});